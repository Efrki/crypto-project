# --- Этап 1: Сборка приложения ---
# Используем официальный образ Gradle с нужной версией JDK (Java 21)
FROM gradle:8.5.0-jdk21 AS build

# Устанавливаем рабочую директорию внутри контейнера
WORKDIR /home/gradle/src

# Копируем все файлы проекта в рабочую директорию
COPY . .

# Запускаем сборку проекта. --no-daemon рекомендуется для CI/CD сред
RUN ./gradlew build --no-daemon

# --- Этап 2: Создание финального образа ---
# Используем минимальный образ только со средой выполнения Java (JRE)
FROM eclipse-temurin:21-jre-jammy

# Копируем только собранный .jar файл из этапа сборки в новый образ
COPY --from=build /home/gradle/src/build/libs/*.jar app.jar

# Указываем, что приложение будет работать на порту 8080
EXPOSE 8080

# Команда для запуска приложения при старте контейнера
ENTRYPOINT ["java", "-jar", "/app.jar"]